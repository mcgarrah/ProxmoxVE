{
    "name": "PowerDNS",
    "slug": "powerdns",
    "categories": [
        5
    ],
    "date_created": "2025-11-12",
    "type": "ct",
    "updateable": true,
    "privileged": false,
    "interface_port": 8081,
    "web_interface_port": 9191,
    "documentation": "https://docs.powerdns.com/",
    "website": "https://www.powerdns.com/",
    "logo": "https://www.powerdns.com/hs-fs/hubfs/logo-footer.jpg",
    "config_path": "/etc/powerdns/pdns.conf",
    "description": "Create a container with PowerDNS installed. Options for authoritative (sqlite), recursor, or both. Useful for split DNS setups and simple recursive resolvers.",
    "default_os": "debian",
    "default_version": "12",
    "options": {
        "role": {
            "type": "string",
            "enum": [
                "authoritative",
                "recursor",
                "both"
            ],
            "default": "authoritative",
            "description": "Role to install in the container: authoritative server, recursor, or both."
        },
        "disk": {
            "type": "integer",
            "default": 4
        },
        "cpu": {
            "type": "integer",
            "default": 1
        },
        "ram": {
            "type": "integer",
            "default": 512
        },
        "install_webui": {
            "type": "boolean",
            "default": false,
            "description": "Install PowerDNS-Admin web interface for easier DNS management (requires 1GB+ RAM, adds ~500MB disk)"
        }
    },
    "examples": [
        {
            "title": "Interactive creation",
            "command": "bash ct/powerdns.sh",
            "notes": "Run the wrapper and choose settings in the interactive menu."
        },
        {
            "title": "Non-interactive with environment variables",
            "command": "var_hostname=powerdns var_ctid=150 var_cpu=1 var_ram=512 var_disk=4 var_os=debian var_version=12 bash ct/powerdns.sh",
            "notes": "Prefill common variables and run the wrapper non-interactively."
        },
        {
            "title": "Install with PowerDNS-Admin web interface",
            "command": "INSTALL_WEBUI=yes var_hostname=powerdns var_ctid=150 var_ram=1024 bash ct/powerdns.sh",
            "notes": "Install PowerDNS with the PowerDNS-Admin web interface for easier management. Requires 1GB+ RAM."
        }
    ],
    "notes": [
        {
            "text": "Authoritative mode installs pdns-server + pdns-backend-sqlite3 and exposes the PowerDNS API/webserver on port 8081 by default. The installer generates an API key and writes it to /etc/powerdns/pdns.conf.",
            "type": "info"
        },
        {
            "text": "Recursor mode installs pdns-recursor and writes a minimal /etc/powerdns/recursor.conf (local-address, allow-from, forward-zones). Update allow-from and forward-zones to implement split-DNS forwarding to internal authoritative servers.",
            "type": "info"
        },
        {
            "text": "To retrieve the generated API key, run `pct exec <CTID> -- grep api-key /etc/powerdns/pdns.conf` on the Proxmox host.",
            "type": "info"
        },
        {
            "text": "For Proxmox SDN integration, the API must be reachable. Set `PDNS_WEB_BIND=0.0.0.0` during install or manually edit `/etc/powerdns/pdns.conf` to change `webserver-address` from `127.0.0.1` to `0.0.0.0` and restart the `pdns` service.",
            "type": "warning"
        },
        {
            "text": "Production recommendation: for larger or HA deployments use a MySQL/Postgres backend (not sqlite) and consider the official PowerDNS APT repositories for timely updates.",
            "type": "info"
        },
        {
            "text": "Security: PDNS_WEB_BIND defaults to 127.0.0.1 to avoid exposing the API. Binding to 0.0.0.0 is dangerous unless protected by a firewall/reverse-proxy with TLS and auth.",
            "type": "warning"
        },
        {
            "text": "PowerDNS-Admin web interface: Set INSTALL_WEBUI=yes to install the PowerDNS-Admin web interface on port 9191. Default credentials are admin/admin (change after first login). Requires 1GB+ RAM and adds ~500MB disk space.",
            "type": "info"
        }
    ],
    "long_description": "This feature creates a Debian-based LXC that installs PowerDNS. The installer supports authoritative (sqlite), recursor, or both roles. It's intended for small/home deployments and testing; for production see notes about backends and security.",
    "quick_notes": [
        "Authoritative mode uses sqlite by default for simplicity. For production or HA setups, consider MySQL/Postgres backends and add database configuration options.",
        "Recursor installs pdns-recursor and writes a minimal /etc/powerdns/recursor.conf with local-address and allow-from. The recursor can forward specific domains to an authoritative server using forward-zones."
    ],
    "additional_examples": [
        {
            "title": "Expose PDNS webserver (dangerous)",
            "command": "PDNS_WEB_BIND=0.0.0.0 ROLE=authoritative bash ct/powerdns.sh",
            "notes": "Exposes the PowerDNS API/webserver on all interfaces. Only use with firewall/proxy protection."
        },
        {
            "title": "Check services from host (replace CTID)",
            "command": "pct exec CTID -- systemctl status pdns && pct exec CTID -- systemctl status pdns-recursor && pct exec CTID -- pdnsutil list-zones",
            "notes": "Verify services and sample zones."
        },
        {
            "title": "Access PowerDNS-Admin web interface",
            "command": "http://container-ip:9191",
            "notes": "If INSTALL_WEBUI=yes was used, access the web interface with admin/admin credentials."
        }
    ],
    "inside_container": {
        "authoritative": "Manage zones with pdnsutil (e.g. pdnsutil create-zone example.local ns1.example.local). Config is at /etc/powerdns/pdns.conf (API key is generated by the installer and webserver listens on port 8081 by default).",
        "recursor": "Edit /etc/powerdns/recursor.conf to update allow-from networks or forward-zones entries for split DNS.",
        "web_interface": "If PowerDNS-Admin is installed, access it at http://container-ip:9191 with default credentials admin/admin. Change password after first login."
    },
    "install_methods": [
        {
            "type": "default",
            "script": "ct/powerdns.sh",
            "resources": {
                "cpu": 1,
                "ram": 512,
                "hdd": 4,
                "os": "debian",
                "version": "12"
            }
        }
    ],
    "default_credentials": {
        "username": null,
        "password": null,
        "web_interface": {
            "username": "admin",
            "password": "admin",
            "note": "Only if PowerDNS-Admin is installed (INSTALL_WEBUI=yes). Change after first login."
        }
    },
    "web_binding": {
        "default_bind": "127.0.0.1",
        "env_var": "PDNS_WEB_BIND",
        "example_expose": "PDNS_WEB_BIND=0.0.0.0 ROLE=authoritative bash ct/powerdns.sh",
        "warning": "Binding to 0.0.0.0 exposes the PDNS API and webserver to any network the container can reach. Even with an API key, this is a security risk on untrusted networks. Use firewall rules, bind to a specific management interface, or run behind a reverse proxy with TLS/auth."
    },
    "suggested_followups": [
        "Add support for MySQL/Postgres backends for larger deployments.",
        "Optionally add a check for the PowerDNS official repos if newer versions are required."
    ],
    "contribution": "Follow the repository contribution guidelines and style in other ct/ and install/ scripts. Keep functions and messages consistent with misc/build.func."
}
